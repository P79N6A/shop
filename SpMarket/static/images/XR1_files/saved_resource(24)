KISSY.add("malldetail/control/floatbar",function(e,t,a){return function(i){function o(){v?t.css(c,{"top":t.scrollTop()+f}):t.css(c,{"bottom":t.scrollTop()+f})}function l(){!0===s||!1!==s&&(v&&t.offset(u?m:c).top<t.scrollTop()+f||!v&&t.offset(u?m:c).top+t.outerHeight(u?m:c)>t.scrollTop()+t.viewportHeight()-f)?u||(n={},e.each(["position",v?"top":"bottom","display"],function(e){n[e]=c.style[e]}),e.UA.ie<=6?(p||(t.css(c,{"display":"none"}),p=!0),r&&clearTimeout(r),r=setTimeout(function(){t.css(c,{"display":"block","position":"absolute"}),a.on(window,"scroll",o),o(),p=!1},100)):t.css(c,v?{"position":"fixed","top":f}:{"position":"fixed","bottom":f}),t.css(m,{"height":t.outerHeight(c,!0)+"px","width":t.outerWidth(c,!0)+"px"}),u=!0,i.cls&&t.addClass(c,i.cls),i.onChange&&i.onChange(u)):u&&(r&&clearTimeout(r),a.remove(window,"scroll",o),t.css(c,n),t.css(m,{"height":"0"}),u=!1,i.cls&&t.removeClass(c,i.cls),i.onChange&&i.onChange(u))}var n,r,s,d=this,c=i.el,m=i.placeHolder||t.create("<div style='height:0;margin-top:0;margin-bottom:0;overflow:hidden;'></div>"),u=!1,p=!1,v=i.bottom===undefined,f=v?Number(i.top)||0:Number(i.bottom)||0;t.parent(c);t.insertAfter(m,c),a.on(window,"scroll",l),l(),e.mix(d,{"isFloating":function(){return u},"setMode":function(e){s=e,l()},"getPlaceHolder":function(){return m}})}},{"requires":["dom","event"]});