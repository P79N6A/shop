KISSY.add("wt-detail/p/card/index",function(e,t,a,n,r,i,o,l,c,s,d,u){"use strict";var h=a.all,p=(o.isDaily(),o.getHostName()),f={"NETWORK":"\u7f51\u7edc\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5","NO_CATE":"\u8bf7\u9009\u62e9\u8d2d\u4e70\u65b9\u5f0f","NO_NET":"\u8bf7\u9009\u62e9\u5165\u7f51\u5730\u533a","NO_PLAN":"\u8bf7\u9009\u62e9\u5408\u7ea6\u5957\u9910","NO_ACTIVITY":"\u8bf7\u9009\u62e9\u4f18\u60e0\u6d3b\u52a8","NO_NUMBER":"\u8bf7\u9009\u62e9\u624b\u673a\u53f7\u7801","NO_CARD":"\u8bf7\u9009\u62e9\u5361\u7247\u7c7b\u578b"};window._CTK5ef0=window._CTK5ef0||function(){function e(e){var t,a,n,r=0;if(0===e.length)return r;for(t=0,n=e.length;t<n;t++)a=e.charCodeAt(t),r=(r<<5)-r+a,r|=0;return r}var t={},a="",n=0;return function(r,i,o,l){function c(){var e,t,a=(window.location.search||"").slice(1).split("&"),n={};for(t=a.length;t--;)2===(e=a[t].split("=")).length&&(n[e[0]]=e[1]);return"true"===n.ctk}function s(t,a){var r="undefined"+n++,i=window[r]=new Image;i.onload=i.onerror=function(){window[r]=null};var o=["type="+encodeURIComponent(l.type||"normal"),"name="+encodeURIComponent(t),"parent="+encodeURIComponent(a||""),"module="+encodeURIComponent(l.dataId||"118"),"msg="+encodeURIComponent(l.msg||""),"version="+encodeURIComponent("0.0.16"),"sample="+g,"time="+(h>0?h:0)].join("&");i.src="//gm.mmstat.com/tmjs.1.1?"+o+"&hash="+e(o)}if(l=l||{},l.reject){"object"!=typeof l.reject&&(l.reject=[l.reject]);for(var d=l.reject.length-1;d>=0;d--)if(t[l.reject[d]])return}a||(a=i);var u=(new Date).valueOf();t[i]=u;var h;if(i==a){var p=window.g_config&&g_config.startTime;h=p?u-p:0}else h=u-(t[o||a]||t[a]);switch(l.autoGroup){case"time":l.group=l.autoGroup+"_"+(h<=0?0:Math.floor(Math.log(h)/Math.log(2)))}"object"==typeof r&&(r=r[l.group||"_"]||Math.round(Math.log(131072)/Math.log(2)));var f=c(),m=null,v=m&&m[Math.floor((u+288e5)/6e5)%144]||1,g=f?1:Math.round(Math.max(Math.pow(2,r)*v/8192,1));Math.floor(Math.random()*g)>0||(l.group&&s(i+"|"+l.group,i),s(i,o))}}(),_CTK5ef0(17,"codetrack.init"),window.console=window.console||{"log":function(){}};var m={"initView":function(e,t,a,n){var r=this;a.onProduct(function(a){r._init(e,t,a,n),n(r)})},"_init":function(e,t,a,n){_CTK5ef0(17,"wtdetail.init","codetrack.init");var r=this;r.$container=h(e),r.$container2=h('<div id="J_WtSKU2" class="wt-detail"></div>'),r.cfg=t,r.product=a,r.callback=n,r._initData={},r._componentDataMap={},r._componentLoadingMap={},r._itemId=a.get("itemDO").itemId,r._selectedSkuId=null,r._initCateSections={},r.cateSelector=null,r.areaSelectorMap={},r.planSelectorMap={},r.numberSelectorMap={},r.cardtypeSelectorMap={},r._fetchInitData(function(){r._render(),r._bindEvent(),r._addBuyValidator(),h("#J_relateGroup li").css({"height":"32px"}),h("#J_relateGroup li i.tm-relate-arrow").css({"bottom":"2px"})})},"_render":function(){_CTK5ef0(17,"wtdetail.render","wtdetail.init");var e=this,t=e._initData||[],a=e.$container.parent().one(".tb-amount");e.$container2.insertBefore(a),e._instCateSelector(t)},"_bindEvent":function(){_CTK5ef0(17,"wtdetail.bindEvent","wtdetail.init");var e=this;e._onSkuChange()},"_fetchInitData":function(e){_CTK5ef0(17,"wtdetail.fetchInitData","wtdetail.init");var t=this,a=p+"/trade/detail/itemOp.do?m=FetchInitData",n={"itemId":t._itemId||0};r({"url":a,"data":n,"dataType":"jsonp","success":function(a){_CTK5ef0(17,"wtdetail.fetchInitData.success","wtdetail.fetchInitData");var r=a.code,i=a.data||[];a.message||f.NETWORK;if(0==r){_CTK5ef0(17,"wtdetail.fetchInitData.success.true","wtdetail.fetchInitData");var o=function(e){for(var t=e,a=0,n=t.length;a<n;a++){var r=t[a]||{};r.skuId&&r.skuId.length?r.isSkuRelate=!0:r.isItemRelate=!0}return t}(i);t._initData=o,e&&e(o)}else _CTK5ef0(0,"error:wtdetail.fetchInitData.success.false","wtdetail.fetchInitData",{"msg":JSON.stringify({"ret":a,"reqData":n}),"type":"error"})},"error":function(e){_CTK5ef0(0,"error:wtdetail.fetchInitData.error","wtdetail.fetchInitData",{"msg":JSON.stringify({"ret":e,"reqData":n}),"type":"error"})}})},"_fetchComponentData":function(e,t){_CTK5ef0(17,"wtdetail.fetchComponentData","wtdetail.init");var a=this,n=(a.product,a._getSelectedSkuId()||0),i=a._itemId||0,o=e.categoryId||0,l=e.versionCode||0,c=e.planId||0,s=p+"/trade/detail/itemOp.do?m=FetchComponentData",d={"skuId":n,"itemId":i,"planId":c,"categoryId":o,"versionCode":l};a._componentLoadingMap[n]||(a._componentLoadingMap[n]={}),a._componentLoadingMap[n][l]=!0,r({"url":s,"data":d,"dataType":"jsonp","success":function(e){_CTK5ef0(17,"wtdetail.fetchComponentData.success","wtdetail.fetchComponentData");var r=e.code,i=e.data||{};e.message||f.NETWORK;if(0==r){_CTK5ef0(17,"wtdetail.fetchComponentData.success.true","wtdetail.fetchComponentData");var o=function(e){for(var t=e||{},a=t.component||[],n=t.componentData||{},r={},i=0,o=a.length;i<o;i++){var l=a[i];r[l]=!0}return r.planLite&&(r.plan=!0,n.plan=n.planLite||{}),t.component=r,t}(i);a._componentDataMap[n]||(a._componentDataMap[n]={}),a._componentDataMap[n][l]=o,t&&t(o)}else _CTK5ef0(0,"error:wtdetail.fetchComponentData.success.false","wtdetail.fetchComponentData",{"msg":JSON.stringify({"ret":e,"reqData":d}),"type":"error"})},"error":function(e){_CTK5ef0(0,"error:wtdetail.fetchComponentData.error","wtdetail.fetchComponentData",{"msg":JSON.stringify({"ret":e,"reqData":d}),"type":"error"})},"complete":function(){a._componentLoadingMap[n][l]=!1}})},"_onSkuChange":function(){var e=this,t=e.product;t.onChange(["selectedSku"],function(t){var a=null;t?e._selectedSkuId=a=t.skuId:e._selectedSkuId=null,e.cateSelector.change(a)})},"_onCateChange":function(e){var t=this,a=t.product;t._renderCateSection(e),t._refreshAmountAndCar(e),a.refreshCanBuyStatus()},"_onCityChange":function(t){var a=this,n=a.product,r=a._getSelectedSkuId(),i=a._getCurCateVerCode(),o=a._getCurAreaSelector(r,i),l=a._getCurPlanSelector(r,i),c=a._getCurNumberSelector(r,i),s=a._getCurComponentData(r,i),d=s.componentData||{},u=o.getCheckedCityData();if(l&&u){for(var h=d.plan||[],p=u.planIds||[],f=[],m=0,v=h.length;m<v;m++){var g=h[m]||{},_=g.planId;e.inArray(_,p)||f.push(_)}l.setDisabled(f)}c&&c.clear(),n.refreshCanBuyStatus()},"_onPlanChange":function(e){var t=this,a=t.product,n=t._getSelectedSkuId(),r=t._getCurCateVerCode(),i=t._getCurNumberSelector(n,r);i&&i.clear(),a.refreshCanBuyStatus()},"_onNumberChange":function(e){var t=this,a=t.product;a.refreshCanBuyStatus()},"_onCardtypeChange":function(e){var t=this,a=t.product;a.refreshCanBuyStatus()},"_refreshAmountAndCar":function(e){if(e){var t=h("#J_Amount").closest("dl.tb-amount"),a=h("#J_LinkBasket");e.hasOwnProperty("limit")&&("true"==e.limit||1==e.limit?(t.hide(),t.one('input[type="text"]').val(1),this.product.set("amount",1)):t.show()),e.hasOwnProperty("noShopCart")&&("true"==e.noShopCart||1==e.noShopCart?a.hide():a.show())}},"_renderCateSection":function(e){var t=this,a=t._getSelectedSkuId();if(e&&(!e.isSkuRelate||a)&&(e.isItemRelate&&(a=0),this._initCateSections[a]||(this._initCateSections[a]={}),!this._initCateSections[a][e.versionCode+"_"+e.planId])){this._initCateSections[a][e.versionCode+"_"+e.planId]=1;var n=e.categoryId,r=e.planId,i=e.versionCode;t._fetchComponentData({"categoryId":n,"versionCode":i,"planId":r},function(e){var o=e.component||{},l=e.componentData||{},c=t._getCateSectionBySkuIdAndVerCode(a,i,r);if(c.all(".j_Loading").remove(),o.area&&t._instAreaSelector(a,i,r),o.plan&&t._instPlanSelector(a,i,n,r),o.phoneNumber){var s=l.phoneNumber&&l.phoneNumber.selectNumType;2!=s&&t._instNumberSelector(a,i,r)}o.cardtype&&t._instCardtypeSelector(a,i,r)})}},"_getSelectedSkuId":function(){var e=this,t=e.cateSelector.curSelectedVerIsItemRelate();return t?0:this._selectedSkuId},"_getCurCateVerCode":function(){return this.cateSelector.getSelectedVersionCode()},"_getCurCateSection":function(){return this.cateSelector.getCurCateSection()},"_getCateSectionBySkuIdAndVerCode":function(e,t,a){return this.cateSelector.getCateSectionBySkuIdAndVerCode(e,t,a)},"_getCurComponentLoading":function(e,t){var a=this,e=e||a._getSelectedSkuId(),t=t||a._getCurCateVerCode();return a._componentLoadingMap[e]&&a._componentLoadingMap[e][t]||!1},"_getCurComponentData":function(e,t){var a=this,e=e||a._getSelectedSkuId(),t=t||a._getCurCateVerCode();return a._componentDataMap[e]&&a._componentDataMap[e][t]||null},"_getCurAreaSelector":function(e,t){var a=this,e=e||a._getSelectedSkuId(),t=t||a._getCurCateVerCode();return a.areaSelectorMap[e]&&a.areaSelectorMap[e][t]||null},"_getCurPlanSelector":function(e,t){var a=this,e=e||a._getSelectedSkuId(),t=t||a._getCurCateVerCode();return a.planSelectorMap[e]&&a.planSelectorMap[e][t]||null},"_getCurNumberSelector":function(e,t){var a=this,e=e||a._getSelectedSkuId(),t=t||a._getCurCateVerCode();return a.numberSelectorMap[e]&&a.numberSelectorMap[e][t]||null},"_getCurCardtypeSelector":function(e,t){var a=this,e=e||a._getSelectedSkuId(),t=t||a._getCurCateVerCode();return a.cardtypeSelectorMap[e]&&a.cardtypeSelectorMap[e][t]||null},"_instCateSelector":function(e){_CTK5ef0(17,"wtdetail.instCateSelector","wtdetail.init");var t=this,a=t.$container2;t.cateSelector=new l({"data":e,"superObj":t,"renderTo":a[0],"onChange":t._onCateChange,"handlerContext":t})},"_instAreaSelector":function(e,t,a){_CTK5ef0(17,"wtdetail.instAreaSelector","wtdetail.init");var n=this,r=n._componentDataMap[e][t]||{},i=n._getCateSectionBySkuIdAndVerCode(e,t,a);n.areaSelectorMap[e]||(n.areaSelectorMap[e]={}),n.areaSelectorMap[e][t]=new c({"data":r.componentData.area||[],"renderTo":i[0],"onChange":n._onCityChange,"handlerContext":n})},"_instPlanSelector":function(e,t,a,n){_CTK5ef0(17,"wtdetail.instPlanSelector","wtdetail.init");var r=this,i=r._componentDataMap[e][t]||{},o=r._getCateSectionBySkuIdAndVerCode(e,t,n);r.planSelectorMap[e]||(r.planSelectorMap[e]={}),r.planSelectorMap[e][t]=new s({"data":i.componentData.plan||[],"superObj":r,"categoryId":a,"renderTo":o[0],"onChange":r._onPlanChange,"handlerContext":r})},"_instNumberSelector":function(e,t,a){_CTK5ef0(17,"wtdetail.instNumberSelector","wtdetail.init");var n=this,r=n._componentDataMap[e][t]||{},i=n._getCateSectionBySkuIdAndVerCode(e,t,a);n.numberSelectorMap[e]||(n.numberSelectorMap[e]={}),n.numberSelectorMap[e][t]=new d({"data":r.componentData.network||[],"superObj":n,"renderTo":i[0],"onChange":n._onNumberChange,"preUseNum":n._preUseNum,"handlerContext":n})},"_instCardtypeSelector":function(e,t,a){_CTK5ef0(17,"wtdetail.instCardtypeSelector","wtdetail.init");var n=this,r=n._componentDataMap[e][t]||{},i=n._getCateSectionBySkuIdAndVerCode(e,t,a);n.cardtypeSelectorMap[e]||(n.cardtypeSelectorMap[e]={}),n.cardtypeSelectorMap[e][t]=new u({"data":r.componentData.cardtype||[],"renderTo":i[0],"onChange":n._onCardtypeChange,"handlerContext":n})},"_preUseNum":function(e,t){_CTK5ef0(17,"wtdetail.preUseNum","wtdetail.init");var a=this,n=a._getSelectedSkuId(),o=a._getCurCateVerCode(),l=a._getCurAreaSelector(n,o),c=a._getCurPlanSelector(n,o),s=a._getCurNumberSelector(n,o),d=l.getCheckedArea(),u=c.getSelectedPlanId(),h=s.getSelectedNum();if(i.get("tracknick")){_CTK5ef0(17,"wtdetail.preUseNum.PreUseNum","wtdetail.preUseNum");var m=p+"/trade/detail/itemOp.do?m=PreUseNum",v={"skuId":n||0,"itemId":a._itemId||0,"planId":u||0,"provId":d&&d.proCode||0,"cityId":d&&d.cityCode||0,"phoneNum":h||0,"versionCode":o||0};r({"url":m,"data":v,"dataType":"jsonp","success":function(a){_CTK5ef0(17,"wtdetail.preUseNum.preUseNum.success","wtdetail.preUseNum.PreUseNum");var n=a.code,r=a.message||f.NETWORK;0==n?(_CTK5ef0(17,"wtdetail.preUseNum.preUseNum.success.true","wtdetail.preUseNum.PreUseNum.success"),e()):(_CTK5ef0(0,"error:wtdetail.preUseNum.preUseNum.success.false","wtdetail.preUseNum.PreUseNum.success",{"msg":JSON.stringify({"ret":a,"reqData":v}),"type":"error"}),t(r))},"error":function(t){_CTK5ef0(0,"error:wtdetail.preUseNum.preUseNum.error","wtdetail.preUseNum.PreUseNum",{"msg":JSON.stringify({"ret":t,"reqData":v}),"type":"error"}),e()}})}else e()},"_addBuyValidator":function(){var e=this,t=e.product;t.addBuyValidator(function(t,a){var n=e._getSelectedSkuId(),r=e._getCurCateVerCode(),i=e._getCurComponentLoading(n,r),o=e._getCurAreaSelector(n,r),l=e._getCurPlanSelector(n,r),c=e._getCurNumberSelector(n,r),s=e._getCurCardtypeSelector(n,r),d=null,u=null,h=null,p=null;if(!r)return void a({"level":2,"name":"sku","message":f.NO_CATE});if(!i){if(o&&(d=o.getCheckedArea(),!d))return void a({"level":2,"name":"sku","message":f.NO_NET});if(l&&(u=l.getSelectedPlanId(),!u))return void a({"level":2,"name":"sku","message":f.NO_PLAN});if(c&&(h=c.getSelectedNum(),!h))return void a({"level":2,"name":"sku","message":f.NO_NUMBER});if(s&&(p=s.getSelectedCardtypeCode(),!p))return void a({"level":2,"name":"sku","message":f.NO_CARD});e._setBuyParam(),a(null)}},2),window.WT_LOADED=!0,t.refreshCanBuyStatus()},"_setBuyParam":function(){_CTK5ef0(17,"wtdetail.setBuyParam","wtdetail.init");var e=this,t=e.product,a=e._getSelectedSkuId(),n=e._getCurCateVerCode(),r=e.cateSelector._getSelectedCate(),i=e._getCurAreaSelector(a,n),o=e._getCurPlanSelector(a,n),l=e._getCurNumberSelector(a,n),c=e._getCurCardtypeSelector(a,n),s=[];if(o){var d=o.getSelectedPlanId();d?s.push(d):s.push(0)}else s.push(0);if(i){var u=i.getCheckedArea();u?(s.push(u.proCode),s.push(u.cityCode)):(s.push(0),s.push(0))}else s.push(0),s.push(0);if(l){var h=l.getSelectedNum(),p=l.getLastSelectedNetwork()||l.getSelectedNetwork();h?s.push(h):s.push(0),p?s.push(p):s.push(0)}else s.push(0),s.push(0);if(c){var f=c.getSelectedCardtypeCode();f?s.push(f):s.push(0)}else s.push(0);n?s.push(n):s.push(0),r.noShopCart?t.setBuyParam("alicom_wtt_cart",0):t.setBuyParam("alicom_wtt_cart",1),_CTK5ef0(17,"wtdetail.setBuyParam.params","wtdetail.setBuyParam",{"group":s.join("_")}),t.setBuyParam("alicom_wtt_param",s.join("_"))},"getSelectedSkuId":function(){return this._getSelectedSkuId()},"getSelectNumParams":function(){var e=this,t=e._getSelectedSkuId(),a=e._getCurCateVerCode(),n=e._getCurAreaSelector(t,a),r=e._getCurPlanSelector(t,a),i=e._getCurNumberSelector(t,a),o={"skuId":e._getSelectedSkuId()||0,"itemId":e._itemId||0,"versionCode":a||0};if(n){var l=n.getCheckedArea();if(!l)return i.showErrorMsg(f.NO_NET),!1;o.provId=l.proCode||0,o.cityId=l.cityCode||0}if(r){var c=r.getSelectedPlanId();if(!c)return i.showErrorMsg(f.NO_PLAN),!1;o.planId=c||0}return i&&i.hideErrorMsg(),o},"getCurAreaNetworkData":function(){var e=this,t=e._getSelectedSkuId(),a=e._getCurCateVerCode(),n=e._getCurAreaSelector(t,a),r=n.getCheckedAreaNetworkData();return r||[]}};return m},{"requires":["dom","node","event","io","cookie","wt-detail/c/util/index","wt-detail/c/category-selector/index","wt-detail/c/area-selector/index","wt-detail/c/plan-selector/index","wt-detail/c/number-selector/index","wt-detail/c/cardtype-selector/index"]});